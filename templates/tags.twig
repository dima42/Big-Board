{% extends 'loggedin.twig' %}

{% block content %}
{% for scope in scopes %}
{% for tag in scope %}
    <div class="tag level{{ tag.level }}" data-level="{{ tag.level }}" data-pk="{{ tag.id }}">
        {{ tag.title }}
        <a class="badge badge-light" href="#" data-behavior="add-tag">+ Child</a>
        <div class="float-right">
            {% if tag.hasNextSibling %}
            <form method="post" class="move-tag" action="/tags/{{ tag.id }}/move_dn">
                <button class="btn btn-light badge badge-light" href="#">&darr;</button>
            </form>
            {% endif %}
            {% if tag.hasPrevSibling %}
            <form method="post" class="move-tag" action="/tags/{{ tag.id }}/move_up">
                <button class="btn btn-light badge badge-light" href="#">&uarr;</button>
            </form>
            {% endif %}
        </div>
    </div>
{% endfor %}
{% endfor %}
{% endblock %}

{% block scripts %}
<script>
$(function() {
    $('[data-behavior=add-tag]').click(function(e) {
        e.preventDefault();
        var parent = $(this).closest('.tag');
        $.get('/templates/add_tag.mst', function(template) {
            var rendered = Mustache.render(template, {
                'parent': parent.data('pk'),
                'level': parent.data('level') + 1
            });
            parent.after(rendered);
            parent.next().find('input').focus();
        });
    });
});
</script>
{% endblock %}
